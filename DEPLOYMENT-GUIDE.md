# Deployment Guide - Arman Law Firm

This guide explains which files are used for each hosting platform.

---

## File Overview

| File | Platform | Purpose |
|------|----------|---------|
| `wrangler.toml` | **Cloudflare Pages** | Frontend static site configuration |
| `render.yaml` | **Render.com** | Backend API server configuration |
| `functions/` | **Cloudflare Pages** | Serverless API functions (alternative to Render) |
| `server/` | **Render.com** | Express server code for backend API |
| `dist/` | **Both** | Built frontend files (generated by `npm run build`) |

---

## Option 1: Cloudflare Pages + Render (Recommended)

Best for: Full features including authentication, database, and user sessions.

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        YOUR WEBSITE ARCHITECTURE                         │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌──────────────────────────┐      ┌──────────────────────────────────┐ │
│  │    CLOUDFLARE PAGES      │      │         RENDER.COM               │ │
│  │    (Frontend)            │      │         (Backend API)            │ │
│  │                          │      │                                  │ │
│  │  Files Used:             │      │  Files Used:                     │ │
│  │  - wrangler.toml         │ ───► │  - render.yaml                   │ │
│  │  - dist/                 │      │  - server/                       │ │
│  │  - index.html            │      │  - package.json                  │ │
│  │                          │      │                                  │ │
│  │  URL:                    │      │  URL:                            │ │
│  │  armanlawfirm.pages.dev  │      │  armanlawfirm-api.onrender.com   │ │
│  └──────────────────────────┘      └──────────────────────────────────┘ │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### Step 1: Deploy Backend on Render

1. Go to [render.com](https://render.com)
2. Click **"New"** > **"Blueprint"**
3. Connect your GitHub repository
4. Render will auto-detect `render.yaml`
5. Set environment variables:
   - `GEMINI_API_KEY` - Your Google AI API key
   - `DATABASE_URL` - PostgreSQL connection string
   - `SESSION_SECRET` - Random secret for sessions

### Step 2: Deploy Frontend on Cloudflare Pages

1. Go to [pages.cloudflare.com](https://pages.cloudflare.com)
2. Click **"Create a project"** > **"Connect to Git"**
3. Select your GitHub repository
4. Configure build settings:
   - **Build command:** `npm run build`
   - **Build output directory:** `dist`
5. Add environment variable:
   - `VITE_API_URL` = `https://armanlawfirm-api.onrender.com`
6. **DO NOT** set deploy command to `npx wrangler deploy`

---

## Option 2: Cloudflare Pages Only (Simple)

Best for: Basic features without authentication or database.

```
┌─────────────────────────────────────────────────────────────────────────┐
│                     CLOUDFLARE PAGES (ALL-IN-ONE)                        │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌──────────────────────────┐      ┌──────────────────────────────────┐ │
│  │    Static Frontend       │      │    Cloudflare Functions          │ │
│  │                          │      │    (Serverless API)              │ │
│  │  Files Used:             │      │                                  │ │
│  │  - wrangler.toml         │      │  Files Used:                     │ │
│  │  - dist/                 │ ───► │  - functions/api/generate.ts     │ │
│  │  - index.html            │      │  - functions/api/health.ts       │ │
│  │                          │      │                                  │ │
│  └──────────────────────────┘      └──────────────────────────────────┘ │
│                                                                          │
│  Single URL: armanlawfirm.pages.dev                                      │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### Deployment Steps

1. Go to Cloudflare Pages
2. Connect GitHub repository
3. Build settings:
   - **Build command:** `npm run build`
   - **Build output directory:** `dist`
4. Environment variables:
   - `GEMINI_API_KEY` - Your Google AI API key

### Limitations

- No user authentication
- No database storage
- No user sessions
- Functions have 30-second timeout

---

## Common Errors and Fixes

### Error: "Workers-specific command in a Pages project"

**Cause:** Deploy command set to `npx wrangler deploy`

**Fix:** 
- In Cloudflare Dashboard, go to Settings > Builds
- Remove the deploy command
- Pages projects deploy automatically, no deploy command needed!

### Error: "Unexpected fields found in build field: environment"

**Cause:** Old wrangler.toml format

**Fix:** Use the updated wrangler.toml in this repository (already fixed)

### Error: API returns 404

**Cause:** Backend not running or wrong API URL

**Fix:**
- Check if Render backend is deployed
- Verify `VITE_API_URL` environment variable points to Render URL

---

## Environment Variables Summary

### Cloudflare Pages

| Variable | Description | Required |
|----------|-------------|----------|
| `VITE_API_URL` | Render backend URL | Yes (if using Render) |
| `GEMINI_API_KEY` | Google AI API key | Yes (if using Functions) |
| `NODE_VERSION` | Node.js version | Optional (default: 20) |

### Render.com

| Variable | Description | Required |
|----------|-------------|----------|
| `GEMINI_API_KEY` | Google AI API key | Yes |
| `DATABASE_URL` | PostgreSQL connection | Yes |
| `SESSION_SECRET` | Session encryption key | Yes |
| `NODE_ENV` | Environment mode | Set to "production" |

---

## Quick Reference

| What You Want | Use This |
|---------------|----------|
| Deploy frontend only | Cloudflare Pages + `wrangler.toml` |
| Deploy backend API | Render + `render.yaml` |
| Serverless functions | Cloudflare Pages + `functions/` folder |
| Full-stack with database | Cloudflare Pages + Render |
| User authentication | Requires Render backend |

---

## Support

For questions about:
- Cloudflare Pages: [developers.cloudflare.com](https://developers.cloudflare.com/pages)
- Render.com: [render.com/docs](https://render.com/docs)
